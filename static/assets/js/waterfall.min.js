$.browser||($.browser={},function(){var e=navigator.userAgent.toLowerCase(),t=/(webkit)[ \/]([\w.]+)/,n=/(opera)(?:.*version)?[ \/]([\w.]+)/,r=/(msie) ([\w.]+)/,i=/(mozilla)(?:.*? rv:([\w.]+))?/,s=t.exec(e)||n.exec(e)||r.exec(e)||e.indexOf("compatible")<0&&i.exec(e)||[];browserMatch={browser:s[1]||"",version:s[2]||"0"},browserMatch.browser&&($.browser[browserMatch.browser]=!0,$.browser.version=browserMatch.version)}());(function(e){!e.History&&!0?(e.History={options:{debug:!1},timer:null,state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},extractHash:function(e){var t=e.replace(/^[^#]*#/,"").replace(/^#+|#+$/,"");return t},getState:function(){var t=e.History;return t.state},setState:function(t){var n=e.History;return t=n.extractHash(t),n.state=t,n.state},getHash:function(){var t=e.History,n=t.extractHash(window.location.hash||location.hash);return n},setHash:function(t){var n=e.History;return t=n.extractHash(t),typeof window.location.hash!="undefined"?window.location.hash!==t&&(window.location.hash=t):location.hash!==t&&(location.hash=t),t},go:function(t){var n=e.History;t=n.extractHash(t);var r=n.getHash(),i=n.getState();return t!==r?n.setHash(t):(t!==i&&n.setState(t),n.trigger()),!0},hashchange:function(t,n,r){var i=e.History;if(!i.nativeSupport&&!i.notSupportTrigger){i.nativeSupport=!0,i.timer&&clearInterval(i.timer);if(i.firedFirstTime)return!1}else i.firedFirstTime=!0,i.notSupportTrigger=!1;var s=i.getHash();return i.go(s),!0},bind:function(t,n){var r=e.History;return n?(typeof r.handlers.specific[t]=="undefined"&&(r.handlers.specific[t]=[]),r.handlers.specific[t].push(n)):(n=t,r.handlers.generic.push(n)),!0},trigger:function(t){var n=e.History;typeof t=="undefined"&&(t=n.getState());var r,i,s,o;if(typeof n.handlers.specific[t]!="undefined"){o=n.handlers.specific[t];for(r=0,i=o.length;r<i;++r)s=o[r],s(t)}o=n.handlers.generic;for(r=0,i=o.length;r<i;++r)s=o[r],s(t);return!0},construct:function(){var t=e.History;return e(document).ready(function(){t.domReady()}),!0},configure:function(t){var n=e.History;return n.options=e.extend(n.options,t),!0},domReadied:!1,domReady:function(){var t=e.History;if(t.domRedied)return;return t.domRedied=!0,t.$window=e(window),t.$window.bind("hashchange",this.hashchange),t.nativeSupport=t.nativeSupport(),setTimeout(t.hashchangeLoader,200),!0},nativeSupport:function(t){t=t||e.browser;var n=t.version,r=parseInt(n,10),i=n.split(/[^0-9]/g),s=parseInt(i[0],10),o=parseInt(i[1],10),u=parseInt(i[2],10),a=!1;if((t.msie||!1)&&r>=8)a=!0;else if((t.webkit||!1)&&r>=528)a=!0;else if(t.mozilla||!1)s>1?a=!0:s===1&&(o>9?a=!0:o===9&&u>=2&&(a=!0));else if(t.opera||!1)s>10?a=!0:s===10&&o>=60&&(a=!0);return a},hashchangeLoader:function(){var t=e.History;if(!t.nativeSupport){var n;if(e.browser.msie){t.$iframe=e('<iframe id="jquery-history-iframe" style="display: none;"></iframe>').prependTo(document.body)[0],t.$iframe.contentWindow.document.open(),t.$iframe.contentWindow.document.close();var r=!1;n=function(){var e=t.getHash(),n=t.getState(),i=t.extractHash(t.$iframe.contentWindow.document.location.hash);n!==e?(r||(t.$iframe.contentWindow.document.open(),t.$iframe.contentWindow.document.close(),t.$iframe.contentWindow.document.location.hash=e),r=!1,t.notSupportTrigger=!0,t.$window.trigger("hashchange")):n!==i&&(r=!0,t.setHash(i))}}else n=function(){var e=t.getHash(),n=t.getState();n!==e&&(t.notSupportTrigger=!0,t.$window.trigger("hashchange"))};t.timer=setInterval(n,2e3)}else{var i=t.getHash();i&&t.$window.trigger("hashchange")}return!0}},e.History.construct()):window.console.warn("$.History has already been defined...")})(jQuery);var template=function(e,t){return template[typeof t=="object"?"render":"compile"].apply(template,arguments)};(function(e,t){"use strict";e.version="1.4.0",e.openTag="<%",e.closeTag="%>",e.parser=null,e.render=function(e,t){var n=l(e);return n===undefined?c({id:e,name:"Render Error",message:"Not Cache"}):n(t)},e.compile=function(t,r){function i(n){try{return(new o(n)).template}catch(i){return s?(i.id=t||r,i.name="Render Error",i.source=r,c(i)):e.compile(t,r,!0)(n)}}var s=arguments[2];typeof r!="string"&&(s=r,r=t,t=null);try{var o=f(r,s)}catch(u){return u.id=t||r,u.name="Syntax Error",c(u)}return i.prototype=o.prototype,i.toString=function(){return o.toString()},t&&(n[t]=i),i},e.helper=function(e,t){a[e]=t};var n={},r="".trim,i=r&&!t.document,s={},o=function(){var e=Array.prototype.forEach||function(e,t){var n=this.length>>>0;for(var r=0;r<n;r++)r in this&&e.call(t,this[r],r,this)};return function(t,n){e.call(t,n)}}(),u=Object.create||function(e){function t(){}return t.prototype=e,new t},a=e.prototype={$forEach:o,$render:e.render,$getValue:function(e){return e===undefined?"":e}};o("break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield".split(","),function(e){s[e]=!0});var f=function(t,n){function i(e){return g+=e.split(/\n/).length-1,e=e.replace(/('|"|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),e=w[1]+"'"+e+"'"+w[2],e+"\n"}function f(e){var t=g;return d?e=d(e):n&&(e=e.replace(/\n/g,function(){return g++,"$line="+g+";"})),e.indexOf("=")===0&&(e=e.substring(1).replace(/[\s;]*$/,""),r&&(e="$getValue("+e+")"),e=w[1]+e+w[2]),n&&(e="$line="+t+";"+e),l(e),e+"\n"}function l(e){e=e.replace(/\/\*.*?\*\/|'[^']*'|"[^"]*"|\.[\$\w]+/g,""),o(e.split(/[^\$\w\d]+/),function(e){if(/^this$/.test(e))throw{message:'Prohibit the use of the "'+e+'"'};if(!e||s.hasOwnProperty(e)||/^\d/.test(e))return;y.hasOwnProperty(e)||(c(e),y[e]=!0)})}function c(e){var t;e==="print"?t=S:e==="include"?t=x:a.hasOwnProperty(e)?t="$helpers."+e:t="$data."+e,b+=e+"="+t+","}var h=e.openTag,p=e.closeTag,d=e.parser,v=t,m="",g=1,y={$out:!0,$line:!0},b="var $helpers=this,"+(n?"$line=0,":""),w=r?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],E=r?"if(content!==undefined){$out+=content;return content}":"$out.push(content);",S="function(content){"+E+"}",x="function(id,data){if(data===undefined){data=$data}var content=$helpers.$render(id,data);"+E+"}";o(v.split(h),function(e,t){e=e.split(p);var n=e[0],r=e[1];e.length===1?m+=i(n):(m+=f(n),r&&(m+=i(r)))}),v=m,n&&(v="try{"+v+"}catch(e){"+"e.line=$line;"+"throw e"+"}"),v=b+w[0]+v+"this.template="+w[3];try{var T=new Function("$data",v),N=T.prototype=u(a);return N.toString=function(){return this.template},T}catch(C){throw C.temp="function anonymous($data) {"+v+"}",C}},l=function(t){var r=n[t];if(r===undefined&&!i){var s=document.getElementById(t);return s&&e.compile(t,s.value||s.innerHTML),n[t]}if(n.hasOwnProperty(t))return r},c=function(e){function n(){return n+""}var r="[template]:\n"+e.id+"\n\n[name]:\n"+e.name;return e.message&&(r+="\n\n[message]:\n"+e.message),e.line&&(r+="\n\n[line]:\n"+e.line,r+="\n\n[source]:\n"+e.source.split(/\n/)[e.line-1].replace(/^[\s\t]+/,"")),e.temp&&(r+="\n\n[temp]:\n"+e.temp),t.console&&console.error(r),n.toString=function(){return"{Template Error}"},n}})(template,this),typeof module!="undefined"&&module.exports&&(module.exports=template);(function(e){e.fn.tabswitch=function(t,n,r){function l(e){e.preventDefault(),c(a.index(this),!0)}function c(e,t){var n=a,r,i=a.index(r),o=-1,l=-1,c=e;r=n.filter("."+f),i=a.index(r),n.add(u).removeClass(f),u.css("display","none").eq(c).css("display","block").add(a.eq(e)).addClass(f),typeof s.fn=="function"&&s.fn(a,u,c,i,t)}var i=this;typeof t!="function"&&(r=n,n=t,t=e.noop),typeof n!="string"&&(r=n,n="");var s=e.extend({},e.fn.tabswitch.defaults,r);s.fn=t;var o=!!n,u=e(s.cont),a=o?e(n,i):i,f=s.focus;return c(s.index),this.data("tabswitched")||(o?this.delegate(n,s.event,l):this.bind(s.event,l),this.data("tabswitched",!0)),i},e.fn.tabswitch.defaults={cont:".tabswitch-cont",focus:"cur",index:0,event:"click"}})(jQuery);(function(e,t){var n=e.location,r=$(e),i,s,o=$.History,u=0,a=!1,f=!1,l=!1,c=!1,h,p,d,v=[],m=[],g,y=function(e){y.init(e)};$.extend(y,{dfConf:{formprefix:"#woo-form-",frame:["#woo-holder",".woo-swa",".woo-swb",".woo-pcont",".woo-pager",".woo-masned"],gopre:null,gonext:null,gotop:null,footer:null,unit:".woo",anchor:"woo-anchor",anchordiff:70,sink:$(null),sinkheight:0,sinkright:!1,unitsnum:24,subpagenum:4,scrollwait:100,lbias:400,appendnum:12,batchopen:!1,batchdelay:6,batchnum:2,nearbypagenum:3,ajaxdatatype:"text",ajaxcache:!1,resize:!1,refreshwhenswitch:!1,onScroll:function(e){},onFirstArrange:function(e){},onOnePageOver:function(e,t){},onLazyAddOver:function(e,t){},onTabSwitch:function(e,t,n,r,i){},requestAlways:function(e,t){}},init:function(t){if(typeof t.arrsplit=="string"){var n=t.arrsplit;t.arrsplit=[]}if(typeof t.arrmasnw=="number"){var u=t.arrmasnw;t.arrmasnw=[]}if(typeof t.arrmargin=="number"){var a=t.arrmargin;t.arrmargin=[]}if(typeof t.arrfmasnw=="number"){var c=t.arrfmasnw;t.arrfmasnw=[]}if(typeof t.arrgap=="number"){var h=t.arrgap;t.arrgap=[]}for(var v=0;v<t.arrform.length;v++)n!==E&&t.arrsplit.push(n),u!==E&&t.arrmasnw.push(u),a!==E&&t.arrmargin.push(a),c!==E&&t.arrfmasnw.push(c),h!==E&&t.arrgap.push(h);this.conf=$.extend({},this.dfConf,t);var t=this.conf,m=t.frame,b=$(m[1]),w=$(m[2]),E;this.$holder=d=$(m[0]);if(!d.length||!b.length||!w.length)return;this.$conts=w,this.$gonext=$(t.gonext),this.$gopre=$(t.gopre),this.$gotop=$(t.gotop),this.$footer=$(t.footer),g=y.WooTemp,i=r.height(),this.iswebkit=$.browser&&$.browser.webkit||!!/webkit/.exec(navigator.userAgent.toLocaleLowerCase()),(o&&!o.getHash()||!o)&&y._switch(b,w),o&&o.bind(function(e){f?f=!1:y._switch(b,w);var t=e.split("-p"),n=parseInt(t[1])||1;n>1?y.$gopre.css("display","block"):y.$gopre.css("display","none")}),this.setClickGoPre(),this.setClickGoNext(),this.setClickGoTop(),r.scroll(function(){l=!0,e.clearTimeout(p),p=e.setTimeout(function(){l=!1},y.conf.scrollwait);var t=r.scrollTop();y.$gotop.css("visibility",t>100?"visible":"hidden")}),r.bind("resize",function(e){y.throttle(function(){i=r.height(),t.resize&&s!=(s=r.width())&&y.resize()},100)})},iswebkit:null,$holder:$(null),masn:[],pagine:[],resetCol:function(e,t,n,r){var i=d.find(this.conf.frame[5]+":visible").not(".woo-tmpmasn"),s=i.data("colY");if(s&&s[n]){s[n]+=e;var o=Math.max.apply(Math,s);i.data("colY",s).css({height:o}),d.find("div.co"+n).each(function(t,n){var i=parseInt(n.style.top);i>r&&(n.style.top=i+e+"px")})}},throttle:function(t,n){e.clearTimeout(y.throttle.timer),y.throttle.timer=setTimeout(function(){t.call(this)},n)},resize:function(){for(var e=0;e<m.length;e++){var t=m[e];e===u&&t?(t.setCols(),t.figure(),t.arrangeContents(!0)):t&&t.resetDomWidth()}},recurseDo:function(t,n,r,i,s){if(r==0){$.isFunction(s)&&s();return}n=t.apply(null,n),n[0].length?e.setTimeout(function(){y.recurseDo(t,n,--r,i,s)},i):$.isFunction(s)&&s()},getFormAction:function(e){return encodeURI(e.attr("action"))},paramForm:function(e,n){var r={};return $("input,select,textarea",e).not("[type=submit]").filter("[name]").each(function(e,n){if(($(n).attr("type")==="checkbox"||$(n).attr("type")==="radio")&&$(n).prop("checked")===!0||$(n).attr("type")!=="checkbox"&&$(n).attr("type")!=="radio")r[n.name]!==t?r[n.name]+=","+n.value:r[n.name]=n.value}),$.isPlainObject(n)&&$.extend(r,n),$.param(r)},setClickGoTop:function(){y.$gotop.click(function(e){e.preventDefault(),e.stopPropagation(),c=!0;var t=this,n=y.iswebkit?$("body"):$("html");n.animate({scrollTop:0},200,function(){t.style.visibility="hidden",c=!1})})},setClickGoPre:function(){y.$gopre.click(function(e){e.preventDefault(),y._clickGo.call(this,-1)})},setClickGoNext:function(){y.$gonext.click(function(e){e.preventDefault(),y._clickGo.call(this,1)})},_clickGo:function(e){var t=y.conf;$(this).css("display","none");if(v&&v[u]&&m&&m[u]){var n=d.find(t.frame[4]+":visible"),r=n.find(".woo-pbr").length,i=v[u]&&v[u].hasNextUpperPage,s=r&&i?!1:!0;if(r&&!i)return;v[u].isPagerClick=!0,s&&(v[u].loading=!1,v[u].lazyAdding=!0,v[u].halting=!0),v[u].slidePage(e,!0)}},_switch:function(e,t){var n=y.conf,r=n.frame,s=n.arrform;e.tabswitch(function(e,n,r,u,l){var c=e.eq(r),h=y._getPageNumFromHash();$.Woo.conf.onTabSwitch(e,n,r,u,l);if(!!l){h=v[r]&&r!=u&&!y.conf.refreshwhenswitch?v[r].getPageNum():1,a=!0,f=!0;if(o){var p="!"+s[r];o.setHash(p+(h>1?"-p"+h:""))}n.eq(r).find(y.conf.frame[3]).last().css("height",i)}g&&g.reset(),v[u]&&(v[u].idata=[],v[u].$data=$(null)),y._pageInit(t,r,h)},{focus:"woo-cur",cont:r[2],index:y._getFocusIdx(e)})},_pageInit:function(n,r,i){u=r;var s=this.conf,o=s.frame,f=s.arrform,l=s.arrsplit,c=s.arrmasnw,p=s.arrmargin,d=s.arrfmasnw,b=s.arrgap,w=l[r],E=n.eq(r),S=E.find(o[3]).not(".woo-tmpmasn"),x=E.find(o[4]),T=parseInt(S.data("totalunits")),N=isNaN(T),C=S.data("wootemp")||0,k=S.data("subpagenum")||s.subpagenum,L=S.data("unitsnum")||s.unitsnum,A=S.data("sink")?$(S.data("sink")):$(s.sink),O=S.data("sinkheight")||s.sinkheight,M=!!S.data("sinkright")||s.sinkright,_=N?2:Math.ceil(T/L),D=!!d[r],P=c[r];mgn=p[r],gap=b[r],fwdt=D?P+d[r]:P,specialopen=fwdt!=P,hsn=_>2?!1:!0,t,this.$footer.css("display",_==1?"block":"none");if(!v[r]){var H,B=$(null);this.masn[r]=m[r]=new y.Masn(S,{unit:s.unit,gap:gap||0,onAppend:y._doLoadImage,onFirstArrange:s.onFirstArrange,onArrange:function(t){t.length&&(H=2,B=t),v[r]&&(v[r].caching=1,v[r].$data=t),h&&e.clearTimeout(h),y._onscroll()},initAppendCounts:L,sinkWhat:A,firstHeight:O,rightAlignFirstBlock:M,specialColumnOpen:specialopen,firstColumnWidth:fwdt,columnWidth:P,columnMargin:mgn,batchOpen:s.batchopen,batchDelay:s.batchdelay,batchNum:s.batchnum}),this.pagine[r]=v[r]=new y.Pagine([S,x],{identity:"!"+f[r],arrRequestUrl:[$(s.formprefix+f[r])[0],w],requestAlways:s.requestAlways,onOnePageOver:s.onOnePageOver,ajaxDataType:s.ajaxdatatype,ajaxCache:s.ajaxcache,scrollBias:s.lbias,anchor:s.anchor,anchorDiff:s.anchordiff,nearbyPageNum:s.nearbypagenum,subPageNum:k,unitsPerSub:L,currentUpperPage:i,totalPageNum:_,caching:H,$data:B,nextMode:hsn,analyzeResponse:g?g.analyzeResponse[C]:$.noop,lazyAdd:function(t){var n=this,i=n.config;if(n.$data.length===0&&n.idata.length===0){n.caching=0,n.isLastSub()&&n.showFooter();return}n.lazyAdding=!0,n.caching=1;var s=n.$data,o=n.idata,a=s&&s.length||0,f=o&&o.length||0,l=a+f,c=t?Math.max(l+1,i.unitsPerSub):y.conf.appendnum,h=a+f-c,p=!1;t&&m[r]&&(m[r].clearColY(),p=!0);var d,v;c<=a?(d=s.slice(0,c),n.$data=s.slice(c)):(d=s,n.$data=$(null),v=o.slice(0,c-a),n.idata=o.slice(c-a));var b=g&&g.render[C]?g.render[C](v):v;m[r].appendContents(d,b,!1,!1,p,y.conf.batchnum,function(t,r){if(h<=0){n.caching=0;var s=n.currentPage,o=i.subPageNum;s%o===0&&n.currentPage!=n.totalPageNum&&e.setTimeout(function(){n.prepareNext()},400),n.isLastSub()&&n.showFooter()}else n.caching=h<=i.unitsPerSub?1:2,n.$pager.css({height:0,overflow:"hidden"});e.setTimeout(function(){n.lazyAdding=!1,y.conf.onLazyAddOver(n,u)},200)})}})}else if(!v[r].lazyAdding&&!v[r].loading||!a)v[r].lazyAdding=!0,v[r].scrollLoading=!0,m[r].setCols(),v[r].refreshPage(i);a=!1,y.$gonext.css("visibility","hidden")},_getIdentityFromHash:function(){var e="";return o&&(e=o.getHash(),e=e.split("-")[0]),e},_getPageNumFromHash:function(){var e=1;if(o){var t=o.getHash();t=t.split("-p")[1],t&&(e=parseInt(t)||e)}return e},_getFocusIdx:function(e){var t=y.conf.arrform,n=y._getIdentityFromHash().substr(1),r=-1;for(var i=0;i<t.length;i++)if(t[i]===n){r=i;break}return r===-1&&e.each(function(e,t){$(t).hasClass("woo-cur")&&(r=e)}),r=r===-1?0:r,r},_onscroll:function(){if(!c){var t=r.scrollTop();v[u]&&!v[u].lazyAdding&&t+i>$("body").height()-y.conf.lbias&&(v[u].doLazyAdd(t,!0),v[u].doLoadNext());if(!l){y.conf.onScroll(t);if(d.length){var n=y.conf,s=y.$gopre,o=y.$gonext,a=d.find(n.frame[4]+":visible"),f=a.find(".woo-pbr").length,p=v[u]&&v[u].hasNextUpperPage;s.add(o).css("visibility",t>d.position().top&&(!f||f&&p)?"visible":"hidden")}}}e.clearTimeout(h),h=e.setTimeout(y._onscroll,100)},_doLoadImage:function(e){e.find("img[srcd]").each(function(e,t){var n=$(t),r=n.attr("srcd");r&&n.css("display","none").one("load",function(){$(this).css({visibility:"visible"}).fadeIn(400)}).one("error",function(){var e=$(this);$({}).delay(1e3).queue(function(){e.one("error",function(){e.attr("src",r)}).attr("src",r)})}).attr("src",r).removeAttr("srcd")})}}),y.Pagine=function(e,t){this.init(e,t)},y.Pagine.prototype={init:function(e,t){this.config=$.extend({},t);var n=this,r=n.config,i=r.currentUpperPage,s=r.subPageNum,o;n.hasNextUpperPage=!0,n.caching=r.caching,n.$data=r.$data||$(null),n.idata=[],n.$dom=e[0],n.$pager=e[1],n.unitsPerSub=r.unitsPerSub,n.totalPageNum=r.totalPageNum,n.currentUpperPage=i,n.currentPage=(i-1)*s+1,n.$loadingsm=$('<div id="woo-loading" class="woo-loading"></div>');var u=r.arrRequestUrl;$.type(u[0])==="object"&&u[0].tagName.toLowerCase()==="form"&&(n.arrurl=u),n.$dom.find(":first-child").length?i>1?(n.clearCont=!0,n.loadPage(n.currentPage,1)):n.setPager():(n.clearCont=!1,n.loadPage(n.currentPage,1))},loadPage:function(e,t,n){if(this.loading){this.scrollLoading=!1;return}var r=this,i=r.config,s=i.subPageNum,o=t&&(e%s===1||s==1),u=!1,f;!t&&r.scrollToAnchor(),r.$pager.css("display","none"),r.pagerVisible=!1,r.loading=!0,r.currentUpperPage=e,s>1&&!t?e=(e-1)*s+1:s>1&&t&&(r.currentUpperPage=Math.floor((e-.1)/s)+1),(!t||o)&&r.clearCont&&(r.changeHashOnFirstLoad(i.identity,r.currentUpperPage),a=!0,u=!0,r.$dom.empty()),r.isPagerClick=!1,r._requestData(e,t,n,!1,u)},scrollToAnchor:function(){var t=this,n=t.config,r=y.iswebkit?$("body"):$("html"),i=$("a[name="+n.anchor+"]");if(n.anchor&&i.length){var s=i.offset().top-n.anchorDiff||0;r.scrollTop()>s&&r.animate({scrollTop:s},200)}else!!e.ActiveXObject&&!e.XMLHttpRequest&&r.animate({scrollTop:0},200)},getPageNum:function(){return this.currentUpperPage},gotoPage:function(e){var t=this;t.clearCont=!0,t.loadPage(e,!1,!0)},refreshPage:function(e){var t=this,n=e||t.currentUpperPage;t.$data=$(null),t.idata=[],t.caching=0,t.halting=!0,t.loading=!1,t.gotoPage(n)},slidePage:function(e,t){var n=this,r=n.currentUpperPage;n.clearCont=!0,n.loadPage(r+e,!1,t)},slideSubPage:function(e){var t=this,n=t.currentPage;t.clearCont=!0,t.loadPage(n+e,1)},jumpPage:function(){var e=this,t=e.$pager.find("[type=text]").val()||0;t&&(e.clearCont=!0,e.loadPage(t))},prepareNext:function(){var e=this,t=e.currentPage;(!e.prepare||e.prepare[0]!==t+1)&&e._requestData(t+1,!0,!1,!0)},requestOver:function(e,t,n,r,i){var s=this,o=s.config,u=!s.$dom.find(":first-child").length,a=o.subPageNum,f=e%a===1,l;s.hasNoMore=!r,s.currentPage=e,s.caching=2,i&&(s.totalPageNum=Math.ceil(i/o.unitsPerSub)),u&&(s.loading=!0);var c=o.nextMode,h=s.currentPage,p=s.currentUpperPage||h,d=s.totalPageNum,v=s.$loadingsm,l;s.$dom.removeClass("woo-loading"),s.isLastSub()||v.css("visibility","hidden"),c||h===d?r?s.totalPageNum=h+1:s.totalPageNum=h:c||(r?h>d&&(s.totalPageNum=h+1):s.totalPageNum=h),s.idata=s.idata.concat(n),o.lazyAdd.call(s,u),(!t||f||s.isLastSub())&&s.setPager(),s.caching?s.$pager.css({display:"block",height:0,overflow:"hidden"}):s.isLastSub()&&s.$pager.css({display:"block",height:"auto"}),s.pagerVisible=!0},_requestAlways:function(){var e=this,t=e.config;e.loading=!1,e.$dom.removeClass("woo-loading"),e.$loadingsm.css("visibility","hidden"),$.isFunction(t.requestAlways)&&t.requestAlways(e,u)},_beforeRequest:function(t){var n=this,r=n.$loadingsm;n.$pager.after(r),y.$footer.css("display","none"),t?(n.$dom.addClass("woo-loading"),r.css("visibility","hidden"),g&&g.reset(),n.idata=[],n.$data=$(null),h&&e.clearTimeout(h),y._onscroll()):r.css("visibility","visible")},_requestData:function(e,t,n,r,i){var s=this,o=s.config,u=o.subPageNum,a=s.arrurl,f;if(a){!r&&s._beforeRequest(i);if(s.prepare&&s.prepare[0]==e)s.requestOver(e,t,s.prepare[1],s.prepare[2],s.prepare[3]),s.prepare=null,$({}).delay(100).queue(function(){s._requestAlways()}),s.scrollLoading=!1;else{var l=$(a[0]);$.ajax({type:"GET",dataType:o.ajaxDataType,cache:typeof DEBUG!="undefined"&&DEBUG?!1:!!o.ajaxCache,url:typeof DEBUG!="undefined"&&DEBUG?"?page="+e:y.getFormAction(l)+e+a[1],data:y.paramForm(l),timeout:2e4,success:function(i){typeof DEBUG!="undefined"&&DEBUG&&(i=DEBUG_DATA[Math.floor((DEBUG_DATA.length-1)*Math.random())]);if(s.halting&&!n)return;n&&(s.halting=!1,s.$dom.empty());var u=o.analyzeResponse(i);if(r){s.prepare=[e,u[0],u[1],u[2]];var a=[];$(u[0]).find("img[srcd]").each(function(e,t){var n=$(t);a.push(n.attr("srcd"))}),y.recurseDo(function(e){return(new Image).src=e.splice(0,1),[e]},[a],a.length,200)}else s.requestOver(e,t,u[0],u[1],u[2]);s.scrollLoading=!1,s._requestAlways()},error:function(n,i){r||$('<div id="woo-retry" style="text-align:center;padding:16px 0 0;height:48px">网络繁忙，<a href="javascript:;">点此重试~</a></div>').click(function(n){n.stopPropagation(),n.preventDefault(),s._requestData(e,t),$(this).remove()}).insertAfter(s.$dom),s._requestAlways()}})}}},hasNextUpperPage:function(){var e=this;return e.hasNextUpperPage},isLastSub:function(){var e=this;return e.currentPage%e.config.subPageNum===0||e.currentPage===e.totalPageNum},showFooter:function(){var t=this;t.$pager.css({height:"auto"}),y.$footer.css("display","block"),t.$loadingsm.remove(),e.setTimeout(function(){t.$data.length===0&&t.idata.length===0&&e.clearTimeout(h)},200),t.config.onOnePageOver(t,u)},setPager:function(){var e=this,t=e.config,n=e.currentUpperPage,r=t.nearbyPageNum,i=e.totalPageNum,s=t.subPageNum,o="",u;i=Math.floor((i-.1)/s)+1,(t.nextMode&&n>=i||!t.nextMode&&n>=i)&&e.hasNoMore&&(e.hasNextUpperPage=!1),e.isLastSub()?(o=['<div class="woo-pbr"><ul class="woo-dib">',n==1?"":'<li><a class="woo-pre" href="javascript:;" pdir="-1" >上一页</a></li>',n==1?'<li class="woo-cur">1</li>':'<li><a href="javascript:;">1</a></li>',n-r>2?'<li class="woo-ell" >…</li>':"",function(){var e="";for(var t=n-r;t<=n+r;t++)t==n&&t!=1?e+='<li class="woo-cur">'+t+"</li>":t>1&&t<=i&&(e+='<li><a href="javascript:;">'+t+"</a></li>");return e}(),n+r<i-1&&!t.nextMode?'<li class="woo-ell" >…</li>':"",n+r<i&&!t.nextMode?'<li><a href="javascript:;">'+i+"</a></li>":"",n==i?"":(t.nextMode?'<li class="woo-ell" >…</li>':"")+'<li><a class="woo-nxt" href="javascript:;"  pdir="1">下一页</a></li>',"</ul></div>"].join(""),e.$pager.find(".woo-pbr").remove(),e.$pager.append(o)):(e.$pager.find(".woo-pbr").remove(),e.$pager.append(o)),e.isEventSetting||(e.addEventOnPagerClick(),e.isEventSetting=!0);var a=y.$gonext;a.css("display","block"),e.$pager.find(".woo-pbr").length&&a.css("visibility",e.hasNextUpperPage?"visible":"hidden"),e.pagerVisible=!0,e.doLazyAdd()},changeHashOnFirstLoad:function(e,t){var n=this,r=e+(t>1?"-p"+t:""),i=o.getHash();(i||n.isPagerClick)&&i!==r&&o.setHash(r)},addEventOnPagerClick:function(){var e=this;e.$pager.click(function(t){var n=t.target;n&&n.tagName&&n.tagName.toLowerCase()!="a"&&(n=$(n).closest("a")[0]);if(n&&n.tagName&&n.tagName.toLowerCase()==="a"&&!$(n).closest(".woo-nopagine",e.$pager.get(0)).length){t.preventDefault(),t.stopPropagation();var r=parseInt(n.innerHTML),i=n.getAttribute("pdir");e.isPagerClick=!0,r?e.gotoPage(r):i==="jump"?e.jumpPage():i==="sub"?e.slideSubPage(1):(i=parseInt(i))&&e.slidePage(i)}})},doLazyAdd:function(e,n){var s=this,o=s.config,e=e===t?r.scrollTop():e,u=s.$dom.data("colY"),a=s.$pager.offset().top-e-i,f=Math.max.apply(Math,u),l=Math.min.apply(Math,u);!s.lazyAdding&&s.pagerVisible&&s.caching&&(n||a<o.scrollBias||a<f-l)&&o.lazyAdd.call(s)},doLoadNext:function(){var e=this,t=e.config;!e.lazyAdding&&!e.halting&&!e.scrollLoading&&e.pagerVisible&&(e.caching<2||!e.caching)&&!e.isLastSub()&&(e.scrollLoading=!0,e.slideSubPage(1))}},y.Masn=function(e,t){this.init(e,t)},y.Masn.prototype={init:function(e,t){this.opts=$.extend({},t);var n=this;n.$dom=$(e),n.domInitWidth=n.$dom.data("domwidth")||"auto",n.figure(),n.arrangeContents(),n.opts.onFirstArrange(u)},figure:function(){var e=this,t=[],n=e.$dom,r=e.opts,i=0,s=$("<div>");n.css({position:"relative"}),e.colwf=e.colw=r.columnWidth,r.firstColumnWidth&&(e.colwf=r.firstColumnWidth),e.setCols();for(var o=0;o<e.colCount;o++)t[o]=0;e.$dom.data("colY",t),n.prepend(s),e.offset0=s.offset(),e.domtop0=n.offset().top,e.left0=Math.round(s.position().left),s.remove(),e.lastscreen=e.screen=0,r.firstHeight&&(e.firstWidth=e.colwf,e.firstHeight=r.firstHeight)},clearColY:function(){var e=this,t=[];for(var n=0;n<e.colCount;n++)t[n]=0;e.$dom.data("colY",t)},setContHeight:function(){var e=this,t=e.$dom.data("colY");e.$dom.css({height:Math.max.apply(Math,t.concat(i-e.domtop0))}).data("colY",t)},setCols:function(){var e=this,t=e.opts,n=e.$dom,r;e.resetDomWidth(),r=e.domWidth,e.colCount=Math.max(Math.floor((r+t.columnMargin-e.colwf+e.colw)/e.colw),1),e.domWidth=e.colCount*e.colw+e.colwf-e.colw-t.columnMargin,n.css("width",e.domWidth)},resetDomWidth:function(){var e=this,t=e.$dom;t.css("width",e.domInitWidth),e.domWidth=e.domInitWidth==="auto"?t.parent().width():e.domInitWidth},arrangeContents:function(e){var t=this,n=t.$dom,r=t.opts,i=r.initAppendCounts,s,o;s=n.children().filter(r.unit),o=s.length;if(o){e&&(i=o);var u=s.slice(0,i);s=s.slice(i).addClass("woo-wait"),t.appendContents(u,null,!0,e,!!r.firstHeight,i,$.noop),r.onAppend(u)}n.css("visibility","visible"),$.isFunction(r.onArrange)&&r.onArrange(s)},appendContents:function(e,t,n,r,i,s,o){var u=this,a=u.opts,f=u.$dom,l=f.data("colY"),s=s||a.batchNum,c,h;u.lastscreen=u.screen;var p=u._placeEachUnit(u,a,f,e,t,n,r,i&&u.firstHeight),d=p[0],v=p[1];n?(a.onAppend(d),u.setContHeight()):(d.appendTo(f),a.batchOpen?y.recurseDo(function(e,t){var n=0;return e.append(function(e){return n++,t.eq(e).children()}),a.onAppend(e),e=e.slice(s),t=t.slice(n),u.setContHeight(),[e,t]},[d,v],Math.ceil(d.length/s),a.batchDelay,function(){o(u.lastscreen,u.screen)}):(d.append(function(e){return v.eq(e).children()}),u.setContHeight(),a.onAppend(d),o(u.lastscreen,u.screen)))},prePlaceUnit:function(e,t,n,r,s){var o=this,u=o.opts,a=n,f,l,c,h,p;f=Math.min.apply(Math,t);while(a--)t[a]==f&&(l=a);return(l===0&&!u.rightAlignFirstBlock||l===n-1&&u.rightAlignFirstBlock)&&o.colwf!=o.colw&&(p=o.colwf,!s&&e.addClass("woo-spcol")),r&&u.specialColumnOpen&&e.removeData("ht").removeAttr("data-ht"),c=o.colw*l+o.left0+(!u.rightAlignFirstBlock&&l&&o.colwf!=o.colw?o.colwf-o.colw:0),h=s?o.firstHeight:e.data("ht")||e.outerHeight(!0),t[l]+=h+u.gap,o.screen=Math.ceil((f+h)/i),[f,l,c,h,p]},_placeEachUnit:function(e,t,n,r,i,s,o,u){var a=n.prev(),f=!!a.length,l="",c=$(null),h=n.data("colY"),p=e.colCount,d,v,m,g,b,w,E=0,S,x=o&&u,T;if(!f||f&&!a.hasClass("woo-tmpmasn")){var N=y.conf.frame,C=(N[3].indexOf(0)=="."?N[3].substr(1):"")+" "+(N[5].indexOf(0)=="."?N[5].substr(1):"")+" woo-loading";a=$('<div class="woo-tmpmasn '+n.attr("class")+'" style="position:relative;height:0;overflow:hidden;margin:0;padding:0;"></div>').removeClass(C),n.before(a)}var k=r.add(i).removeClass("woo-wait"),L=s?k.parent():a.append(k);c=L.find(t.unit).not(".woo-f,.woo-wait").each(function(n,r){var i=$(r),s=i.data("id");if(n===0&&u&&!t.rightAlignFirstBlock||n===p-1&&u&&t.rightAlignFirstBlock)d=e.prePlaceUnit(i,h,p,o,u),v=d[0],m=d[1],g=d[2],b=d[3],w=d[4],S='<div class="woo woo-f sc'+e.screen+" co"+m+" "+(w?"woo-spcol":"")+'" data-ht="'+b+'" style="position:absolute;overflow:hidden;top:'+v+"px;left:"+g+"px;width:"+(e.firstWidth-t.columnMargin)+'px;"></div>',l+=S,x?T=L.find(".woo-f:first").css({left:g,top:v}):T=$(S).append(t.sinkWhat),E=n;d=e.prePlaceUnit(i,h,p,o),v=d[0],m=d[1],g=d[2],b=d[3],w=d[4],l+='<div class="'+t.unit.substr(1)+" sc"+e.screen+" co"+m+" "+(w?"woo-spcol":"")+'" '+(s?'data-id="'+s+'"':"")+' data-ht="'+b+'" style="top:'+v+"px;left:"+g+'px;"></div>',i.css({top:v,left:g}).data("ht",b).removeClass(function(e,t){return"woo-spcol "+(t.match(/(co|sc)\d+/ig)||[]).join(" ")}).addClass((w?"woo-spcol ":"")+"sc"+e.screen+" co"+m)}),n.data("colY",h);if(!x&&u){var A=c.toArray();c=$(A.slice(0,E).concat(T?T.toArray():[],A.slice(E)))}return a.empty(),[$(l),c]}},$.Woo=y})(window);String.prototype.lenB||(String.prototype.lenB=function(){return this.replace(/[^\x00-\xff]/g,"**").length}),String.prototype.leftB||(String.prototype.leftB=function(e){var t=this,n=t.slice(0,e),r=n.replace(/[^\x00-\xff]/g,"**").length;if(r<=e)return n;r-=n.length;switch(r){case 0:return n;case e:return t.slice(0,e>>1);default:var i=e-r,s=t.slice(i,e),o=s.replace(/[\x00-\xff]/g,"").length;return o?t.slice(0,i)+s.leftB(o):t.slice(0,i)}}),String.prototype.cut||(String.prototype.cut=function(e,t,n){var i=this;return r=n?i.substr(0,e):i.leftB(e),r==i?r:r+(typeof t=="undefined"?"…":t)}),function(){function u(e){var t=$.trim(e),r=t.substr(0,1);if(r!="{"&&r!="["){if(t.substr(0,9)==="<!doctype")return[[],!0];n&&(t=t.replace(/(<img[^>]* class=[\'\"]?i[\'\"]?[^>\"\']*)src/ig,function(e,t){return t+"srcd"}));var i=$(t).filter(".woo"),s=i.attr("hasnext")==="False"?!1:!0;return[i.toArray(),s]}return null}if(!$.Woo)return;var e=navigator.userAgent.toString().toLowerCase(),t=!!e.match(/ipad/ig),n=!t,r=[],i=[],s=[],o=[];s=['<% for (var i = 0; i < list.length; i ++) { %> 	<% var u = list[i],indx = $unit(u.id,u),olnk = $outlnk(u); %> 	<% if(!indx) continue; %> <div class="woo"><div class="j"> 	<div class="mbpho" style="height:<%=u.iht > 800 ? 800 : u.iht%>px;"><a target="_blank" class="a" href="http://www.duitang.com/people/mblog/<%=u.id%>/detail/"><img <%=srcd ? "srcd" : "src"%>="<%=u.isrc%>" height="<%=u.iht%>" /><%= u.iht > 800 ? "<u style=\'margin-top:-"+(u.iht-720)+"px\'></u>" : ""%></a> 	</div> 	<div class="d"><span class="d1 d1-done"><%=u.favc%></span><span class="d2 d2-done"><%=u.zanc%></span><span class="d3"><%=u.repc%></span></div> 	<div class="g"><%=u.msg%><% if(olnk){ %>&nbsp;<%=$price(u,olnk)%><% } %></div> 	<ul> 	<li class="f"><a target="_blank" href="http://www.duitang.com/topics/"><img width="24" height="24" src="<%=u.ava%>"></a><p><a class="p" target="_blank" href="http://www.duitang.com/topics/"><%=$cut(u.unm,16)%></a>&nbsp;收集到&nbsp;<% if(u.albid){ %><a target="_blank" href="http://www.duitang.com/topics/"><%=$cut(u.albnm,12)%></a>&nbsp;专辑中<% }else{ %><a target="_blank" href="http://www.duitang.com/topics/">默认专辑</a><% } %></p></li> <% for(var j=0,l=hasrp?u.cmts.length:0; j<l; j++){ %> 	<li><a target="_blank" href="http://www.duitang.com/topics/"><img width="24" height="24" src="<%=u.cmts[j].ava%>"></a><p><a target="_blank" href="http://www.duitang.com/topics/"><%=$cut(u.cmts[j].name,16)%></a>&nbsp;<%=u.cmts[j].cont%></p></li> <% } %></div></div><% } %>',null,null],i=[function(e){if(e&&e.length&&$.isPlainObject(e[0])){var t=o[0],r={list:e,srcd:n,hasrp:t.hasrp},i=template.compile(s[0]),u=$.trim(i(r));return u}return e},null,null],r=[function(e){var t=u(e);if(t)return t;var n=[[],!0];try{var r=$.isPlainObject(e)?e:$.parseJSON(e)}catch(i){return console.log(i),n}if(r.success){var s=r.data,a;o[0]={hasrp:!!s.hasrp},n=[s.blogs,s.has_next,s.totalcount]}return n},function(e){typeof DEBUG!="undefined"&&DEBUG&&(e={data:{totalcount:8907,has_next:!0,albums:[]},success:!0},e.data.albums[23]=0);var t=u(e);if(t)return t;var n=[[],!0];try{var r=$.isPlainObject(e)?e:$.parseJSON(e)}catch(i){return console.log(i),n}if(r.success){var s=$(null),o=r.data;for(var a=0,f=o.albums,l=f.length;a<l;a++){var c=['<div class="woo"  data-ht="328"> <div class="albbigimg"> <p class="lev2"></p> <p class="lev1"></p> <a class="lev0" href="http://www.duitang.com/topics/" target="_blank" ><img src="http://cdn.duitang.com/uploads/item/201208/07/20120807235954_URvcE.thumb.200_200_c.jpeg" alt="动漫集 ."></a> <p class="lev3"></p> <div>动漫集 .</div> </div> <ul> <li><span>3736个收集 | 103人喜欢</span></li> <li class="clr"><a href="http://www.duitang.com/topics/" target="_blank" ><img src="http://cdn.duitang.com/uploads/people/201309/15/20130915021315_kyMMu.thumb.24_24_c.jpeg" />笑我作茧自缚还…</a></li> <li>有壁纸.</li> </ul> </div>'].join("");s=s.add($(c))}n=[s.toArray(),o.has_next]}return n},function(e){var t=u(e);if(t)return t;var n=[[],!0];try{var r=$.isPlainObject(e)?e:$.parseJSON(e)}catch(i){return console.log(i),n}if(r.success){var s=$(null),o=r.data,a=96;for(var f=0,l=o.blogs,c=l.length;f<c;f++){var h=Math.round(l[f].iht*a/200),p=l[f].iht>800?'<div class="mask"></div>':"",d=p?384:h;unt=['<div class="woo" data-ht="'+d+'"><div class="j" style="height:'+d+'px;"><a href="http://m.duitang.com/people/mblog/'+l[f].id+'/detail/"><img srcd="'+l[f].isrc+'" width="96" /></a>'+p+"</div></div>"].join(""),s=s.add($(unt))}n=[s.toArray(),o.has_next]}return n}],template.helper("$price",function(e,t){return e.buylnk?'<a class="dymprice bl dib '+(e.price?"":"by")+'" href="'+t+'" target="_blank"><u class="_tb" title="去购买">'+(e.price?"￥"+e.price:"&nbsp;")+"</u></a>":""}),template.helper("$outlnk",function(e){var t=e.buylnk||"";return t}),template.helper("$cut",function(e,t){return e.cut(t,"…")}),template.helper("$unit",function(e,t){e+="";var n=a.masnUnits;return n[e]?0:(n[e]=t,a.ulen++,n[e].indx=a.ulen-1,a.ulen)});var a=function(){var e={ulen:0,init:function(t,n){e.analyzeResponse=t,e.render=n,e.masnUnits={}},reset:function(){e.ulen=0,e.masnUnits={}}};return e}();a.init(r,i),$.Woo.WooTemp=a}();